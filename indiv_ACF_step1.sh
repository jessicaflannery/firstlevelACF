#!/bin/bash 
#SBATCH	 --job-name indACF_SHAPES #name of file that will show up for job
#SBATCH --output=output/indACF_SHAPES.log #rename to match your task
#SBATCH --error=output/indACF_SHAPES_err.txt #creates an error log. rename to match your task
#SBATCH --time=1-00:00:00
#SBATCH --cpus-per-task=1
#SBATCH --ntasks=1
#SBATCH --mem=1g
#SBATCH --partition=general #partitions and specifics of your sbatch commands will depend on your university server, edit.
#SBATCH --array=0-438 #array starts at 0 and goes through full subject list. Eg. if you had 20 subjects, this would read 0-19.

# Estimate acf parameters for each subject and save as text file
# ------------------------------------------------------------------------------------------

#set sub array to run as batch #add all subs you want individual resids calcuated.
SUBJLIST=(NT1001 NT1044 NT1085 NT1124 NT1158 NT2008 NT2061 NT2106 NT2154 NT2201 NT3010 NT3063 NT3111 NT3155 NT3203
NT1003 NT1045 NT1086 NT1125 NT1160 NT2009 NT2062 NT2107 NT2155 NT2203 NT3011 NT3064 NT3114 NT3156 NT3204
NT1004 NT1046 NT1087 NT1126 NT1161 NT2010 NT2063 NT2110 NT2156 NT2204 NT3012 NT3068 NT3115 NT3158 NT3205
NT1005 NT1047 NT1088 NT1128 NT1162 NT2011 NT2064 NT2111 NT2157 NT2205 NT3013 NT3070 NT3116 NT3160 NT3207
NT1006 NT1048 NT1089 NT1130 NT1163 NT2012 NT2068 NT2114 NT2158 NT2206 NT3015 NT3071 NT3118 NT3161 NT3208
NT1007 NT1054 NT1090 NT1131 NT1166 NT2013 NT2071 NT2115 NT2160 NT2207 NT3017 NT3072 NT3119 NT3162 NT3209
NT1008 NT1055 NT1092 NT1132 NT1167 NT2015 NT2072 NT2116 NT2161 NT2208 NT3018 NT3074 NT3123 NT3163 NT3210
NT1009 NT1056 NT1093 NT1133 NT1169 NT2017 NT2074 NT2118 NT2162 NT2209 NT3019 NT3075 NT3124 NT3170 NT3211
NT1010 NT1057 NT1095 NT1134 NT1170 NT2018 NT2075 NT2119 NT2163 NT2210 NT3022 NT3077 NT3125 NT3172 NT3212
NT1011 NT1058 NT1096 NT1135 NT1172 NT2019 NT2077 NT2122 NT2170 NT2211 NT3023 NT3078 NT3126 NT3173 NT3213
NT1012 NT1059 NT1097 NT1136 NT1173 NT2022 NT2078 NT2124 NT2172 NT2212 NT3027 NT3079 NT3128 NT3175 NT3214
NT1013 NT1060 NT1098 NT1137 NT1174 NT2023 NT2079 NT2125 NT2173 NT2213 NT3028 NT3080 NT3131 NT3176 NT3215
NT1015 NT1061 NT1099 NT1138 NT1175 NT2027 NT2080 NT2126 NT2175 NT2214 NT3029 NT3081 NT3132 NT3182 NT3218
NT1017 NT1062 NT1102 NT1139 NT1176 NT2028 NT2081 NT2128 NT2176 NT2215 NT3030 NT3085 NT3133 NT3184 NT3220
NT1018 NT1063 NT1103 NT1140 NT1178 NT2029 NT2084 NT2131 NT2182 NT2216 NT3032 NT3086 NT3134 NT3185 NT3221
NT1019 NT1064 NT1104 NT1141 NT1179 NT2030 NT2085 NT2133 NT2184 NT2217 NT3037 NT3087 NT3135 NT3186 NT3222
NT1022 NT1065 NT1106 NT1142 NT1182 NT2032 NT2086 NT2134 NT2185 NT2218 NT3038 NT3088 NT3136 NT3187 NT3226
NT1023 NT1068 NT1107 NT1143 NT1184 NT2037 NT2087 NT2135 NT2186 NT2219 NT3040 NT3090 NT3137 NT3188 NT3228
NT1024 NT1070 NT1108 NT1144 NT1185 NT2038 NT2088 NT2136 NT2187 NT2220 NT3043 NT3092 NT3138 NT3189
NT1025 NT1071 NT1110 NT1145 NT1186 NT2040 NT2090 NT2137 NT2188 NT2221 NT3044 NT3093 NT3139 NT3190
NT1026 NT1072 NT1111 NT1147 NT1187 NT2043 NT2092 NT2138 NT2189 NT2222 NT3045 NT3095 NT3140 NT3191
NT1027 NT1074 NT1112 NT1148 NT1188 NT2044 NT2093 NT2139 NT2190 NT2226 NT3047 NT3096 NT3141 NT3192
NT1028 NT1075 NT1114 NT1149 NT1189 NT2045 NT2095 NT2140 NT2191 NT2228 NT3054 NT3097 NT3142 NT3193
NT1029 NT1077 NT1115 NT1150 NT1190 NT2047 NT2096 NT2141 NT2193 NT2999 NT3055 NT3098 NT3143 NT3194
NT1030 NT1078 NT1116 NT1151 NT1191 NT2054 NT2097 NT2142 NT2194 NT3003 NT3056 NT3099 NT3144 NT3196
NT1032 NT1079 NT1117 NT1153 NT1192 NT2055 NT2098 NT2143 NT2196 NT3005 NT3058 NT3102 NT3145 NT3197
NT1037 NT1080 NT1118 NT1154 NT1999 NT2056 NT2099 NT2144 NT2197 NT3006 NT3059 NT3103 NT3147 NT3198
NT1038 NT1081 NT1119 NT1155 NT2005 NT2058 NT2102 NT2145 NT2198 NT3007 NT3060 NT3104 NT3151 NT3199
NT1040 NT1083 NT1122 NT1156 NT2006 NT2059 NT2103 NT2147 NT2199 NT3008 NT3061 NT3106 NT3153 NT3200
NT1043 NT1084 NT1123 NT1157 NT2007 NT2060 NT2104 NT2151 NT2200 NT3009 NT3062 NT3110 NT3154 NT3201)

SUBID=${SUBJLIST[$SLURM_ARRAY_TASK_ID]}
echo ${SUBID}

# load afni
module load afni/20.3.00
module load r/3.6.0

echo 'R_LIBS_USER="/proj/telzerlab/R/libs"' >  $HOME/.Renviron #this was to make sure it referenced correct R lib. edit per your uni.
export R_MAX_VSIZE=32000000000 

fxDir=/proj/telzerlab/NT_SPM12/ #edit your fx directory 

cd ${fxDir}/${SUBID}/Shapes_Zero/ #edit to fit your file pathways

touch ${SUBID}_ACF.txt

for res in Res_*; do

echo $res `3dFWHMx -acf -mask ${fxDir}/${SUBID}/Shapes_Zero/mask.nii $res` >> ${SUBID}_ACF.txt

done

